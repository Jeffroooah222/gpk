#!/usr/bin/env node

'use strict';

process.title = 'gpk';

const {install, test} = require('../lib/gpk');
const {processArgs} = require('../lib/cli');

const config = {
  'production': {
    value: false,
    valid: a => (a === true || a === false),
    fallback: false
  }
};

const cmds = ['install', 'test'];
const {cmd, settings} = processArgs(process.argv, config, cmds);

(async () => {
  const cwd = process.cwd();
  let code = 0;

  switch (cmd) {
    case 'install':
      await install(cwd);
      break;
    case 'test':
      code = await test(cwd);
      break;
    default:
      console.log('Unrecognized command.');
  }

  process.exit(code);
})().catch((err) => {
  console.error(err.stack);
  process.exit(1);
});
